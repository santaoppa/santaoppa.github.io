---
title: "[React] useReducer란?"
excerpt: ""

categories:
  - React
tags:
  - [React]

toc: true
toc_sticky: true

date: 2025-04-28
last_modified_at: 2025-04-28
---

## reducer란?
한 컴포넌트에서 state 업데이트가 여러 이벤트 핸들러로 업데이트가 되는 경우 컴포넌트 관리하기 어려워짐.
따라서, state를 업데이트하는 모든 로직을 reducer를 사용해 컴포넌트 외부로 분리한 단일 함수로 통합해 관리할 수 있음

## reducer 작성하기
### reducer 적용 전
```js
const [tasks, setTasks] = useState(initialTasks);

function handleAddTask(text) {
  setTasks([...tasks, {
    id: nextId++,
    text: text,
    done: false
  }]);
}

function handleChangeTask(task) {
  setTasks(tasks.map(t => {
    if (t.id === task.id) {
      return task;
    } else {
      return t;
    }
  }));
}

function handleDeleteTask(taskId) {
  setTasks(
    tasks.filter(t => t.id !== taskId)
  );
}
```
   
### 1. reducer 함수 작성하기
현재의 state 값과 action 객체를 인자로 받고 state 값을 반환함

```js
function tasksReducer(tasks, action) {
  switch (action.type) {
    case 'added': {
      return [...tasks, {
        id: action.id,
        text: action.text,
        done: false
      }];
    }
    case 'changed': {
      return tasks.map(t => {
        if (t.id === action.task.id) {
          return action.task;
        } else {
          return t;
        }
      });
    }
    case 'deleted': {
      return tasks.filter(t => t.id !== action.id);
    }
    default: {
      throw Error('Unknown action: ' + action.type);
    }
  }
}
```

> ⚠️ reducer는 렌더링 중에 실행되므로 입력 값이 같다면 결과 값도 항상 같아야 한다. (객체와 배열을 변경하지 않고 업데이트)

### 2. 이벤트 핸들러에서 action을 dispatch 함수로 전달하는 것으로 바꾸기
```js
function handleAddTask(text) {
  dispatch({
    type: 'added',
    id: nextId++,
    text: text,
  });
}

function handleChangeTask(task) {
  dispatch({
    type: 'changed',
    task: task
  });
}

function handleDeleteTask(taskId) {
  dispatch({
    type: 'deleted',
    id: taskId
  });
}
```

### 3. 컨포넌트에서 reducer 사용하기
```js
import { useReducer } from 'react';
```

```js
const [tasks, dispatch] = useReducer(tasksReducer, initialTasks);
```

## Immer로 reducer 작성하기
```js
import {useImmerReducer} from 'use-immer';
```

```js
const [tasks, dispatch] = useImmerReducer(tasksReducer, initialTasks);
```

```js
function tasksReducer(draft, action) {
  switch (action.type) {
    case 'added': {
      draft.push( { id: action.id, text: .text, done: false})
      break;
    }
    case 'changed': {
      const target = draft.find(item => item.id === action.task.id);
      target.task = action.task;
      break;
    }
    case 'deleted': {
      return draft.filter(t => t.id !== action.id);
    }
    default: {
      throw Error('Unknown action: ' + action.type);
    }
  }
}
```